# osbuilder: onexstack æŠ€æœ¯æ ˆè„šæ‰‹æ¶å·¥å…·

**osbuilderï¼š** onexstack æŠ€æœ¯æ ˆä½¿ç”¨çš„ Go é¡¹ç›®å¼€å‘è„šæ‰‹æ¶ã€‚

## onexstack æŠ€æœ¯æ ˆä»‹ç»

onexstack æ˜¯ä¸€æ•´å¥— Go å¼€å‘æŠ€æœ¯æ ˆã€‚è¯¥æŠ€æœ¯æ ˆåŒ…æ‹¬äº†ä»¥ä¸‹å†…å®¹ï¼š
- å­¦ä¹ ç¤¾ç¾¤ï¼ˆæ¬¢è¿åŠ å…¥ï¼‰ï¼š[äº‘åŸç”Ÿ AI å®æˆ˜è¥](https://t.zsxq.com/5T0qC)
- é«˜è´¨é‡çš„ Go é¡¹ç›®ï¼š[ã€Œäº‘åŸç”Ÿ AI å®æˆ˜è¥ã€é¡¹ç›®ä»‹ç»](https://konglingfei.com/cloudai/project/cloudai.html)
- é«˜è´¨é‡çš„è¯¾ç¨‹ï¼š[ã€Œäº‘åŸç”Ÿ AI å®æˆ˜è¥ã€ä½“ç³»è¯¾ä»‹ç»](https://konglingfei.com/cloudai/catalog/cloudai.html)
- ä¸€ç³»åˆ—å¼€å‘è§„èŒƒï¼š[æŠ€æœ¯æ ˆç›¸å…³è§„èŒƒ](https://konglingfei.com/onex/convention/rest.html)
- ä¸€ç³»åˆ—å¼€å‘æ ‡å‡†åŒ…/å·¥å…·ï¼š[onexstack æ ‡å‡†åŒ–åŒ…](https://github.com/onexstack/onexstack)

onexstack æŠ€æœ¯æ ˆä¸­ï¼Œæ‰€æœ‰çš„ Web æœåŠ¡å™¨ç±»å‹çš„é¡¹ç›®éƒ½æ˜¯ä½¿ç”¨ `osbuilder` è„šæ‰‹æ¶è‡ªåŠ¨ç”Ÿæˆï¼Œä¾‹å¦‚ï¼š[miniblog](https://github.com/onexstack/miniblog)ã€‚

## osbuilder å·¥å…·ä»‹ç»

### osbuilder å·¥å…·ä»‹ç»

osbuilder æ˜¯ä¸€ä¸ª Go é¡¹ç›®å¼€å‘è„šæ‰‹æ¶ï¼Œå¯ä»¥ä¸€é”®ç”Ÿæˆä¸€ä¸ªç¬¦åˆ Go æœ€ä½³å®è·µçš„ Go é¡¹ç›®ã€‚è¯¥é¡¹ç›®é›†åˆäº†æˆ‘è¿‡å»å¯¹ Go é¡¹ç›®å¼€å‘ã€å¯¹æŠ€æœ¯ã€å¯¹æ¶æ„çš„æ€è€ƒå’Œç»éªŒã€‚ä¸ªäººæ„Ÿè§‰ç”Ÿæˆçš„ Go é¡¹ç›®ä»ä»£ç è´¨é‡ã€æ‰©å±•èƒ½åŠ›ã€çµæ´»æ€§ç­‰æ–¹é¢ï¼Œéƒ½å¤„åœ¨ä¸€ä¸ªå¾ˆä¸é”™çš„æ°´å¹³ã€‚æ˜¯ä¸ªéå¸¸å€¼å¾—å­¦ä¹ çš„ Go é¡¹ç›®æ„å»ºæ–¹å¼ã€‚


osbuilder å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ç‰¹ç‚¹ï¼š
- æ”¯æŒä¸€æ¡å‘½ä»¤ç”Ÿæˆä¸€ä¸ªå¯ç›´æ¥è¿è¡Œçš„é«˜è´¨é‡ã€é«˜æ‰©å±•ã€æ ‡å‡†ã€ç¬¦åˆ Go å¼€å‘æœ€ä½³å®è·µçš„ Go é¡¹ç›®ï¼›
- æ”¯æŒä¸€æ¡å‘½ä»¤æ·»åŠ å¤šä¸ª REST èµ„æºçš„ä»£ç å®ç°ï¼›
- æ”¯æŒä¸åŒçš„ Web æ¡†æ¶ï¼Œä¾‹å¦‚ï¼š**gin**ã€**grpc**ã€kratosã€kitexã€hertzã€go-zeroã€echoã€irisç­‰ï¼›
- æ”¯æŒä¸åŒçš„å­˜å‚¨åç«¯ï¼Œä¾‹å¦‚ï¼š**memory**ã€**mariadb/mysql**ã€**sqlite**ã€**postgresql**ã€mongoã€etcdã€redis ç­‰ï¼›
- æ”¯æŒè‡ªåŠ¨æ·»åŠ å¥åº·æ£€æŸ¥æ¥å£ï¼›
- æ”¯æŒä¸€é”®å®ç°å¸¦ç”¨æˆ·ç®¡ç†ã€è®¤è¯ã€é‰´æƒåŠŸèƒ½çš„ Web æœåŠ¡ï¼›
- æ”¯æŒå…¨é“¾è·¯å¯è§‚æµ‹ï¼ŒåŒ…æ‹¬ï¼šTracingã€Metricsã€Logsï¼Œå¹¶æ”¯æŒç”Ÿæˆç¤ºä¾‹ Metrics ä»£ç ï¼›
- æ”¯æŒè‡ªåŠ¨æ³¨å†Œåˆ°ä¸åŒçš„æœåŠ¡ä¸­å¿ƒï¼Œä¾‹å¦‚ï¼š**polaris**ã€nacosã€consulã€eurekaï¼›
- æ”¯æŒç”Ÿæˆç¬¦åˆæœ€ä½³å®è·µçš„ Dockerfileï¼ŒåŒ…æ‹¬ï¼šdebug é•œåƒå’Œ distroless é•œåƒï¼Œå¹¶ç”Ÿæˆ `make image` æ„å»ºé•œåƒè§„åˆ™ï¼›
- æ”¯æŒè‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡ã€ç»“æ„åŒ–çš„ Makefile æ–‡ä»¶ï¼Œå¹¶ä¸”è‡ªåŠ¨ç”Ÿæˆå¸¸ç”¨çš„ Makefile è§„åˆ™ï¼š
- æ”¯æŒæŒ‡å®š Go æ¨¡å—åï¼›
- ç”ŸæˆåŒ¹é…ã€ä¸°å¯Œçš„ README.md æ–‡ä»¶ï¼›
- ä½¿ç”¨ `osbuilder create quickstart` å¿«é€Ÿåˆ›å»ºä¸€ä¸ªç¤ºä¾‹ Go é¡¹ç›®ï¼›
- æ”¯æŒå®Œæ•´çš„é¡¹ç›®å‘å¸ƒèƒ½åŠ›ï¼šè‡ªåŠ¨ç”Ÿæˆè¯­ä¹‰åŒ–çš„æ ‡ç­¾ã€ç”Ÿæˆ CHANGELOGã€æ‰§è¡Œå‘å¸ƒç­‰

ç”Ÿæˆçš„ Go é¡¹ç›®å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
- é«˜è´¨é‡ã€é«˜æ‰©å±•ã€ç®€æ´ï¼›
- ç›®å½•ç»“æ„ã€ä»£ç æ¶æ„ã€ä»£ç å®ç°å‡ç¬¦åˆ Go ç¼–ç è§„èŒƒåŠæœ€ä½³å®è·µï¼›

### å®‰è£…

```bash
go install github.com/onexstack/osbuilder/cmd/osbuilder@latest
$ osbuilder version
```

## osbuilder è„šæ‰‹æ¶ä½¿ç”¨

osbuilder è„šæ‰‹æ¶å¯ä»¥ç”¨æ¥ç”Ÿäº§ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œä¹Ÿèƒ½å¤ŸåŸºäºå·²æœ‰çš„é¡¹ç›®æ·»åŠ æ–°çš„ REST èµ„æºã€‚


### 1. ç”Ÿæˆæ–°é¡¹ç›®

```bash
$ mkdir -p $GOPATH//src/github.com/onexstack
$ cd $GOPATH//src/github.com/onexstack
$ curl -fsSL https://raw.githubusercontent.com/onexstack/osbuilder/master/internal/osbuilder/tpl/project.yaml -o project.yaml
$ osbuilder create project --config project.yaml ./miniblog
...
ğŸº Project creation succeeded miniblog
ğŸ’» Use the following command to start the project ğŸ‘‡:
...
ğŸ¤ Thanks for using osbuilder.
ğŸ‘‰ Visit https://t.zsxq.com/5T0qC to learn how to develop miniblog project.
```

æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œå¯ä»¥æ ¹æ®æç¤ºï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½²å¹¶æµ‹è¯•æœåŠ¡ï¼š
```bash
$ cd ./miniblog # enter project directory
$ make deps # (Optional, executed when dependencies missing) Install tools required by project.
$ make protoc.apiserver # generate gRPC code
$ go mod tidy # tidy dependencies
$ go generate ./... # run all go:generate directives
$ make build BINS=mb-apiserver # build mb-apiserver
$ _output/platforms/linux/amd64/mb-apiserver # run the compiled server
$ curl http://127.0.0.1:5555/healthz # run health client to test the API
{"timestamp":"2025-08-24 13:23:19"}
```

å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªé¡¹ç›®çš„ç”Ÿæˆè¿‡ç¨‹å¾ˆä¸æ»‘ï¼Œè€Œä¸”ç”Ÿæˆçš„é¡¹ç›®è·Ÿ [miniblog](https://github.com/onexstack/miniblog) ä¿æŒé«˜åº¦ä¸€è‡´ã€‚miniblog é¡¹ç›®æœ‰å®Œæ•´çš„å¼€å‘ä½“ç³»è¯¾ï¼Œæƒ³å­¦ä¹ çš„å¯ä»¥åŠ å…¥ [äº‘åŸç”Ÿ AI å®æˆ˜è¥](https://t.zsxq.com/5T0qC)ã€‚


> æç¤ºï¼šå¦‚æœæƒ³ç”Ÿäº§å¸¦è®¤è¯é‰´æƒçš„é¡¹ç›®å®ä¾‹ï¼Œéœ€è¦è®¾ç½®ï¼šwebserver[0].withUser ä¸º `true`ã€‚

### 2. åŸºäºå·²æœ‰é¡¹ç›®æ·»åŠ æ–°çš„ REST èµ„æº

```bash
# -b é€‰é¡¹æŒ‡å®šç»™ mb-apiserver èµ„æºæ·»åŠ æ–°çš„ REST èµ„æºï¼š
# - postï¼šæ–‡ç« 
# - commentï¼šè¯„è®º
# - tagï¼šæ ‡ç­¾	
# - followï¼šå…³æ³¨
# - followerï¼šç²‰ä¸
# - friendï¼šå¥½å‹
# - blockï¼šé»‘åå•
# - likeï¼šç‚¹èµ	
# - bookmarkï¼šæ”¶è—
# - shareï¼šåˆ†äº«
# - reportï¼šä¸¾æŠ¥
# - voteï¼šæŠ•ç¥¨
$ kinds="post,comment,tag,follow,follower,friend,block,like,bookmark,share,report,vote"
$ osbuilder create api -b mb-apiserver --kinds $kinds
```

ä¸Šè¿°å‘½ä»¤ä¼šæ·»åŠ  2 ä¸ªæ–°çš„ REST èµ„æºï¼šCronJobã€Jobã€‚æ¥ä¸‹æ¥ï¼Œä½ åªéœ€è¦æ·»åŠ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å³å¯ã€‚

æ‰§è¡Œå®Œ `osbuilder` å‘½ä»¤ä¹‹åï¼Œä¼šæç¤ºå¦‚ä½•è¿›è¡Œç¼–è¯‘ã€‚æŒ‰æç¤ºç¼–è¯‘å¹¶æµ‹è¯•ï¼š
```bash
$ make protoc.apiserver 
$ make build BINS=mb-apiserver
$ _output/platforms/linux/amd64/mb-apiserver
# æç¤ºï¼šå¦‚æœæŒ‡å®šäº† withUser: trueï¼Œåˆ™éœ€è¦ç»™ HTTP å®¢æˆ·ç«¯æ·»åŠ è®¤è¯ä¿¡æ¯ï¼Œå¦åˆ™ä¼šæŠ¥ï¼šUnauthenticated é”™è¯¯
# åˆ›å»ºä¸€ä¸ªç©ºçš„æ–‡ç« ï¼ˆæ–‡ç« å†…å®¹ä¸ºç©ºï¼‰ï¼Œå…·ä½“è°ƒç”¨çš„æ¥å£ï¼Œå¯ä»¥æŸ¥çœ‹ scripts/startup-test.sh è„šæœ¬
$ sh scripts/startup-test.sh posts create '{}'
X-Trace-Id: 64c2835d72bb15fc07765de10e6283a1
-----------------------------
{
  "postID": "post-zhwu4c"
}
$ sh scripts/startup-test.sh posts get 'post-zhwu4c' # è·å–åˆšåˆ›å»ºçš„æ–‡ç« è¯¦æƒ…ï¼Œä¼ å…¥æ–‡ç«  ID
X-Trace-Id: 95c631460b60aa91ccb477380a8521ba
-----------------------------
{
  "post": {
    "postID": "post-zhwu4c",
    "createdAt": {
      "seconds": 1761728366
    },
    "updatedAt": {
      "seconds": 1761728366,
      "nanos": 834460375
    }
  }
}
```

### 3. æ ¹æ®éœ€è¦æ·»åŠ  REST èµ„æºçš„å…·ä½“ä¸šåŠ¡é€»è¾‘

æ¥ä¸‹æ¥ï¼Œåªéœ€è¦æ ¹æ®éœ€è¦å®ç° REST èµ„æºçš„å…·ä½“ä¸šåŠ¡é€»è¾‘å³å¯ã€‚ä¾‹å¦‚ ä¿®æ”¹ï¼š`internal/<component_name>/biz/v1/<rest_name>/<rest_name>.go`ã€‚

## å¿«é€Ÿåˆ›å»ºä¸€ä¸ªç¤ºä¾‹ Go é¡¹ç›®

osbuilder è„šæ‰‹æ¶æ”¯æŒä¸€ä¸ªå‘½ä»¤ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªå¯è¿è¡Œã€å¯æµ‹è¯•çš„ä¼ä¸šçº§ Go é¡¹ç›®æ¡†æ¶ï¼Œåˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š
```bash
$ osbuilder create quickstart
```

ä¸Šè¿°å‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `miniblog` é¡¹ç›®ï¼ŒæŒ‰ç…§å‘½ä»¤è¡Œæç¤ºï¼Œå³å¯å®Œæˆé¡¹ç›®çš„ç¼–è¯‘ã€è¿è¡Œå’Œæµ‹è¯•ã€‚

ä½ å¯ä»¥æ‰§è¡Œ `osbuilder create quickstart -h` å®šåˆ¶æ›´å¤šé¡¹ç›®å‚æ•°ã€‚
